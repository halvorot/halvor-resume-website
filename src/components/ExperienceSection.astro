---
import { Image } from "astro:assets";
import { getImage } from "astro:assets";
import { getCollection } from "astro:content";
import H1 from "./H1.astro";
import H2 from "./H2.astro";
import ExperienceItem from "./ExperienceItem.astro";
import BadgeItem from "./BadgeItem.astro";
import snowyMountainsBackgroundImage from "../assets/images/snowy-mountains-bg.jpg";
import wishlyLogo from "../assets/images/wishly-logo.png";
import hLogo from "../icons/h-logo.svg";

const optimizedBackgroundImage = await getImage({
  src: snowyMountainsBackgroundImage,
});
const backgroundImageCss = `url(${optimizedBackgroundImage.src})`;

const experiences = await getCollection("experience");
const orderedExperiences = [...experiences].sort((a, b) =>
  a.data.startDate > b.data.startDate ? -1 : 1,
);
---

<section id="experience" class="bg-image-section pb-14">
  <main class="text-white m-auto max-w-3xl p-4">
    <H1 preText="My " gradientText="experience" />
    <H2 text="Timeline" />
    <div class="mb-14">
      <span
        class="bg-orange-500 absolute left-1/2 hidden h-[59rem] w-0.5 md:block"
      ></span>
      {
        orderedExperiences.map((experience, index) => {
          const { startDate, endDate, heading, subHeading, description, tags } =
            experience.data;
          return (
            <div
              class={`flex w-full ${
                index % 2 === 0 ? "justify-end" : "justify-start"
              }`}
            >
              <ExperienceItem
                {startDate}
                {endDate}
                {heading}
                {subHeading}
                {description}
                {tags}
                align={index % 2 === 0 ? "left" : "right"}
                classes="xs:max-w-xs"
              />
            </div>
          );
        })
      }
    </div>
    <H2 text="Personal projects" />
    <div class="flex justify-evenly">
      <BadgeItem
        href="https://github.com/halvorot/wishly-wishlist-app/tree/main"
        image={wishlyLogo}
        imageAlt="Wishly logo"
        title="Wishly - The Wishlist App"
      />
      <BadgeItem
        href="https://github.com/halvorot/halvorot.github.io"
        image={hLogo}
        imageAlt="Halvor Teigen logo"
        title="This website"
        badgeBackgroundClass="bg-black"
      />
    </div>
  </main>
</section>

<style define:vars={{ backgroundImageCss }}>
  .bg-image-section {
    position: relative;
  }

  .bg-image-section::before {
    content: "";
    position: absolute;
    z-index: -10;
    top: 0;
    width: 100%;
    height: 100%;
    background-image: var(--backgroundImageCss);
    background-size: cover; /* Adjust as needed */
    opacity: 0.15; /* Adjust the opacity as needed (0.0 to 1.0) */
  }
</style>
